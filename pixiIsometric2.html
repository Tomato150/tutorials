
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>PeepsQuest Dev</title>
    <!-- Stylesheets -->
    <link rel='stylesheet' type='text/css' href='css/style.css' />

    <!-- Scripts -->
    <!--[if lt IE 9]><script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body>

  <div id="page-wrapper">

    <div class="row">

      <!-- Sidebar -->
      <section id="sidebar" class="col sidebar">
        <h2><a href="index.html#">PeepsQuest Dev</a></h2>
        <ul>
          <li><a href="https://github.com/peepsquest/tutorials">Github</a></li>
        </ul>
        
        <h2 id='h-tutorialsindexhtml'><a href="index.html">Tutorials</a></h2>
<h3 id='h-general'>General</h3>
<ul>
<li><a href="creatingSpritesheets.html">Creating Sprite Sheets</a></li>
</ul>
<h3 id='h-pixijs'>Pixi.js</h3>
<ul>
<li><a href="pixiBasics.html">Basics</a></li>
<li><a href="pixiIsometric1.html">Isometric Map - Basics</a></li>
<li><a href="pixiIsometric2.html">Isometric Map - Height</a></li>
</ul>

      </section>

      <!-- Main Body -->
      <article id="content" class="col content">
        <a href='index.html'>
          <img id="logo" src="img/peepsquest.png" />
        </a>
        <h1 id='h-pixijs-isometric-map-part-2-tiles-with-height'>Pixi.js Isometric Map Part 2 - Tiles with Height</h1>
<p><div class='section-example'><p>In this example a spritesheet is loaded (generated by Projmate) from the wonderful
<a href="http://kenney.nl/assets">Isometric Road Tiles (nova) by Kenney</a>.</p>
<p>Once loaded an isometric map is rendered using <code>Frames</code> from the loaded spritesheet.</p>
<div id="pixiisometric20_tabs" class="tabs">
  <ul>
    <li class="active">
  <a href="#pixiisometric20result-tab" rel="pixiisometric20result-tab">
    result
  </a>
</li><li>
  <a href="#pixiisometric20scriptjs-tab" rel="pixiisometric20scriptjs-tab">
    script.js
  </a>
</li><li>
  <a href="#pixiisometric20markuphtml-tab" rel="pixiisometric20markuphtml-tab">
    markup.html
  </a>
</li><li>
  <a href="#pixiisometric20stylecss-tab" rel="pixiisometric20stylecss-tab">
    style.css
  </a>
</li>
  </ul>
</div>
<div id="pixiisometric20_tabs_content" class="tabs_content">
  <div id="pixiisometric20result-tab" class="tab_content">
  <iframe id="pixiisometric20" src="examples/pixiIsometric20.html" class="result"  style='height: 310px;'></iframe>
</div><div id="pixiisometric20scriptjs-tab" class="tab_content">
  <pre><code class="language-js"><span class="keyword">var</span> WIDTH = <span class="number">700</span>;
<span class="keyword">var</span> HEIGHT = <span class="number">300</span>;
<span class="keyword">var</span> stage = <span class="keyword">new</span> PIXI.Stage(<span class="number">0xEEFFFF</span>);
<span class="keyword">var</span> renderer = PIXI.autoDetectRenderer(WIDTH, HEIGHT);
document.body.appendChild(renderer.view);

<span class="keyword">var</span> loader = <span class="keyword">new</span> PIXI.AssetLoader([<span class="string">'img/roadTiles.json'</span>]);

<span class="comment">// map</span>
<span class="keyword">var</span> G = <span class="number">0</span>,
  D = <span class="number">1</span>,
  W = <span class="number">2</span>;
<span class="keyword">var</span> terrain = [
  [G, G, G, G, W],
  [D, D, G, G, W],
  [D, G, G, W, W],
  [D, G, W, W, W],
  [G, G, W, W, W],
];

<span class="comment">// Tiles with height can exceed these dimensions.</span>
<span class="keyword">var</span> tileHeight = <span class="number">50</span>;
<span class="keyword">var</span> tileWidth = <span class="number">50</span>;

<span class="comment">// tiles</span>
<span class="keyword">var</span> grass = isoTile(<span class="string">'grass.png'</span>);
<span class="keyword">var</span> dirt = isoTile(<span class="string">'dirt.png'</span>);
<span class="keyword">var</span> water = isoTile(<span class="string">'water.png'</span>);
<span class="keyword">var</span> sand = isoTile(<span class="string">'beach.png'</span>);
<span class="keyword">var</span> tileMethods = [grass, dirt, water, sand];

<span class="function"><span class="keyword">function</span> <span class="title">isoTile</span><span class="params">(filename)</span> {</span>
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(x, y)</span> {</span>
    <span class="keyword">var</span> tile = PIXI.Sprite.fromFrame(filename);
    tile.position.x = x;
    tile.position.y = y;

    <span class="comment">// bottom-left</span>
    tile.anchor.x = <span class="number">0</span>;
    tile.anchor.y = <span class="number">1</span>;
    stage.addChild(tile);
  }
}

<span class="function"><span class="keyword">function</span> <span class="title">drawMap</span><span class="params">(terrain, xOffset, yOffset)</span> {</span>
  <span class="keyword">var</span> tileType, x, y, isoX, isoY, idx;

  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, iL = terrain.length; i &lt; iL; i++) {
    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>, jL = terrain[i].length; j &lt; jL; j++) {
      <span class="comment">// cartesian 2D coordinate</span>
      x = j * tileWidth;
      y = i * tileHeight;

      <span class="comment">// iso coordinate</span>
      isoX = x - y;
      isoY = (x + y) / <span class="number">2</span>;

      tileType = terrain[i][j];
      drawTile = tileMethods[tileType];
      drawTile(isoX + xOffset, isoY + yOffset);
    }
  }
}

loader.onComplete = start;
loader.load();

<span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span> {</span>
  drawMap(terrain, WIDTH / <span class="number">2</span>, tileHeight * <span class="number">1.5</span>);

  <span class="function"><span class="keyword">function</span> <span class="title">animate</span><span class="params">()</span> {</span>
    requestAnimFrame(animate);
    renderer.render(stage);
  }
  requestAnimFrame(animate);
}</code></pre>
</div><div id="pixiisometric20markuphtml-tab" class="tab_content">
  <pre><code class="language-html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span>&gt;</span>
  <span class="tag">&lt;<span class="title">head</span>&gt;</span>
    <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">'stylesheet'</span> <span class="attribute">type</span>=<span class="value">'text/css'</span> <span class="attribute">href</span>=<span class="value">'../css/reset.css'</span> /&gt;</span>
    <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">'stylesheet'</span> <span class="attribute">type</span>=<span class="value">'text/css'</span> <span class="attribute">href</span>=<span class="value">'pixiisometric20-style.css'</span> /&gt;</span>
  <span class="tag">&lt;/<span class="title">head</span>&gt;</span>
  <span class="tag">&lt;<span class="title">body</span>&gt;</span>
    <span class="comment">&lt;!--
&lt;script src="http://code.jquery.com/jquery-1.9.1.min.js"&gt;&lt;/script&gt;
&lt;script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"&gt;&lt;/script&gt;
&lt;script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"&gt;&lt;/script&gt;
--&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"js/vendor/pixi.dev.js"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">'text/javascript'</span> <span class="attribute">src</span>=<span class="value">'pixiisometric20-script.js'</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
</code></pre>
</div><div id="pixiisometric20stylecss-tab" class="tab_content">
  <pre><code class="language-css"><span class="tag">body</span> <span class="rules">{
  <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span></span></span>;
  <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">0</span></span></span>;
<span class="rule">}</span></span></code></pre>
</div>
</div><h2 id='h-setup-stage-and-renderer'>Setup Stage and Renderer</h2>
<p>Setup the stage as usual.</p>
<pre><code class="js"><span class="keyword">var</span> WIDTH = <span class="number">700</span>;
<span class="keyword">var</span> HEIGHT = <span class="number">300</span>;
<span class="keyword">var</span> stage = <span class="keyword">new</span> PIXI.Stage(<span class="number">0xEEFFFF</span>);
<span class="keyword">var</span> renderer = PIXI.autoDetectRenderer(WIDTH, HEIGHT);
document.body.appendChild(renderer.view);</code></pre>
<h2 id='h-loading-the-sprite-sheet'>Loading the Sprite Sheet</h2>
<p>Loading the SpriteSheet is as simple as specifiying the URL to the JSON file
and assigning a handler to <code>loader.onComplete</code>. Pixi.js
treats a JSON file as Texture Packer metadata. With this metadata,
Pixi.js is able to load images from areas in the spritesheet and creates a <code>Frame</code>
for each.</p>
<p>Frame are used to construct <code>Texture</code> objects which in turn are used to create <code>Sprite</code> objects.</p>
<pre><code class="js"><span class="keyword">var</span> loader = <span class="keyword">new</span> PIXI.AssetLoader([<span class="string">'img/roadTiles.json'</span>]);</code></pre>
<h2 id='h-map-and-tile-metadata'>Map and Tile Metadata</h2>
<p>Here is the map we want to render on the stage.</p>
<pre><code class="js"><span class="comment">// map</span>
<span class="keyword">var</span> G=<span class="number">0</span>, D=<span class="number">1</span>, W=<span class="number">2</span>;
<span class="keyword">var</span> terrain = [
    [G, G, G, G, W],
    [D, D, G, G, W],
    [D, G, G, W, W],
    [D, G, W, W, W],
    [G, G, W, W, W],
];

<span class="comment">// Tiles with height can exceed these dimensions.</span>
<span class="keyword">var</span> tileHeight = <span class="number">50</span>;
<span class="keyword">var</span> tileWidth = <span class="number">50</span>;

<span class="comment">// tiles</span>
<span class="keyword">var</span> grass = isoTile(<span class="string">'grass.png'</span>);
<span class="keyword">var</span> dirt = isoTile(<span class="string">'dirt.png'</span>);
<span class="keyword">var</span> water = isoTile(<span class="string">'water.png'</span>);
<span class="keyword">var</span> sand = isoTile(<span class="string">'beach.png'</span>);
<span class="keyword">var</span> tileMethods = [grass, dirt, water, sand];</code></pre>
<h2 id='h-drawing-tiles'>Drawing Tiles</h2>
<p>In an earlier tutorial, flat isometric tiles were drawn from the north corner. We quickly see
an error in that logic. Tiles with height (z-direction) seem to float as they are drawn
from the top instead of the bottom. Ooops!</p>
<pre><code class="js"><span class="function"><span class="keyword">function</span> <span class="title">isoTile</span><span class="params">(filename)</span> {</span>
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(x, y)</span> {</span>
    <span class="keyword">var</span> tile = PIXI.Sprite.fromFrame(filename);
    tile.position.x = x;
    tile.position.y = y;

    <span class="comment">// middle-top</span>
    tile.anchor.x = <span class="number">0.5</span>;
    tile.anchor.y = <span class="number">0</span>;
    stage.addChild(tile);
  }
}</code></pre>
<p><img src="examples/img/spritesheet-floating-water.png" alt=""></p>
<p>The water and dirt appear to float at top of the grassline. The fix
is to draw tiles from the bottom left. Fortunately,
Pixi provides an anchor property. Too easy!</p>
<pre><code class="js"><span class="function"><span class="keyword">function</span> <span class="title">isoTile</span><span class="params">(filename)</span> {</span>
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(x, y)</span> {</span>
    <span class="keyword">var</span> tile = PIXI.Sprite.fromFrame(filename);
    tile.position.x = x;
    tile.position.y = y;

    <span class="comment">// bottom-left</span>
    tile.anchor.x = <span class="number">0</span>;
    tile.anchor.y = <span class="number">1</span>;
    stage.addChild(tile);
  }
}</code></pre>
<h2 id='h-rendering-the-isometric-map'>Rendering the Isometric Map</h2>
<p>The map is drawn as before with the x-axis increasing
in southeast direction and the y-axis increasing in a southwest direction.</p>
<pre><code class="js"><span class="function"><span class="keyword">function</span> <span class="title">drawMap</span><span class="params">(terrain, xOffset, yOffset)</span> {</span>
    <span class="keyword">var</span> tileType, x, y, isoX, isoY, idx;

    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, iL = terrain.length; i &lt; iL; i++) {
        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>, jL = terrain[i].length; j &lt; jL; j++) {
            <span class="comment">// cartesian 2D coordinate</span>
            x = j * tileWidth;
            y = i * tileHeight;

            <span class="comment">// iso coordinate</span>
            isoX = x - y;
            isoY = (x + y) / <span class="number">2</span>;

            tileType = terrain[i][j];
            drawTile = tileMethods[tileType];
            drawTile(isoX + xOffset, isoY + yOffset);
        }
    }
}</code></pre>
<p>Everything is ready. Tell the loader to load and when it finishes
<code>start</code> puts the example in motion.</p>
<pre><code class="js">loader.onComplete = start;
loader.load();

<span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span> {</span>
  drawMap(terrain, WIDTH / <span class="number">2</span>, tileHeight * <span class="number">1.5</span>);

  <span class="function"><span class="keyword">function</span> <span class="title">animate</span><span class="params">()</span> {</span>
    requestAnimFrame(animate);
    renderer.render(stage);
  }
  requestAnimFrame(animate);
}</code></pre>
</div></p>

      </article>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
  <script src="examples/tutdown.js"></script>
  <script>
  $(function() {
    $('.more-details').click(function() {
      $this = $(this);
      if ($this.hasClass('collapsed')) {
        $this.removeClass('collapsed');
        $this.addClass('uncollapsed');
      } else {
        $this.removeClass('uncollapsed');
        $this.addClass('collapsed');
      }
    });
  });
  </script>
  <!--
  <script type="text/javascript">
    (function() {
      var b = document.createElement("script"); b.type = "text/javascript"; b.async = true;
      b.src = "https://barc.com/js/libs/barc/barc.js";
      var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(b, s);
    })();
  </script>
  -->
  <script type="text/javascript">
    $('#sidebar a').each(function() {
      var
        $a = $(this),
        href = window.location.href;
      if (href.indexOf && href.indexOf($a.attr('href')) > -1 && href.indexOf('#') === -1) // hacky to grab only example links
        $a.closest('li').addClass('active');
    });
  </script>
</body>
</html>

